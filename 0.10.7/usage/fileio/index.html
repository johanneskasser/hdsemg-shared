
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A Python library toolbox to work with high-density surface electromyography (HDsEMG) data.">
      
      
        <meta name="author" content="Johannes Kasser">
      
      
        <link rel="canonical" href="https://johanneskasser.github.io/hdsemg-shared/0.10.7/usage/fileio/">
      
      
        <link rel="prev" href="../../installation/pip/">
      
      
        <link rel="next" href="../filters/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>fileio - hdsemg-shared</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#file-io" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="hdsemg-shared" class="md-header__button md-logo" aria-label="hdsemg-shared" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            hdsemg-shared
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              fileio
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/johanneskasser/hdsemg-shared" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    hdsemg-shared
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="hdsemg-shared" class="md-nav__button md-logo" aria-label="hdsemg-shared" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    hdsemg-shared
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/johanneskasser/hdsemg-shared" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    hdsemg-shared
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Installation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/conda/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conda
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/pip/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pip
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Usage Documentation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Usage Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    fileio
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    fileio
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#supported-file-types" class="md-nav__link">
    <span class="md-ellipsis">
      Supported File Types
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-api-load_file" class="md-nav__link">
    <span class="md-ellipsis">
      Main API: load_file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Data Structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Example Usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#internal-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Internal Structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#saving-data" class="md-nav__link">
    <span class="md-ellipsis">
      Saving Data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      API Documentation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Documentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio" class="md-nav__link">
    <span class="md-ellipsis">
      hdsemg_shared.fileio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.file_io" class="md-nav__link">
    <span class="md-ellipsis">
      file_io
    </span>
  </a>
  
    <nav class="md-nav" aria-label="file_io">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.file_io.load_file" class="md-nav__link">
    <span class="md-ellipsis">
      load_file()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.otb_4_file_io" class="md-nav__link">
    <span class="md-ellipsis">
      otb_4_file_io
    </span>
  </a>
  
    <nav class="md-nav" aria-label="otb_4_file_io">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.otb_4_file_io.load_otb4_file" class="md-nav__link">
    <span class="md-ellipsis">
      load_otb4_file()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.otb_4_file_io.parse_otb4_tracks_xml" class="md-nav__link">
    <span class="md-ellipsis">
      parse_otb4_tracks_xml()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.otb_4_file_io.read_novecento_plus" class="md-nav__link">
    <span class="md-ellipsis">
      read_novecento_plus()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.otb_4_file_io.read_standard_otb4" class="md-nav__link">
    <span class="md-ellipsis">
      read_standard_otb4()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.otb_plus_file_io" class="md-nav__link">
    <span class="md-ellipsis">
      otb_plus_file_io
    </span>
  </a>
  
    <nav class="md-nav" aria-label="otb_plus_file_io">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.otb_plus_file_io.build_channel_description" class="md-nav__link">
    <span class="md-ellipsis">
      build_channel_description()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.otb_plus_file_io.load_otb_file" class="md-nav__link">
    <span class="md-ellipsis">
      load_otb_file()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.otb_plus_file_io.parse_otb_xml" class="md-nav__link">
    <span class="md-ellipsis">
      parse_otb_xml()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.otb_plus_file_io.scale_otb_data" class="md-nav__link">
    <span class="md-ellipsis">
      scale_otb_data()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../filters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    filters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../preprocessing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    preprocessing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../grid/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    grid
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#supported-file-types" class="md-nav__link">
    <span class="md-ellipsis">
      Supported File Types
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-api-load_file" class="md-nav__link">
    <span class="md-ellipsis">
      Main API: load_file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Data Structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Example Usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#internal-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Internal Structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#saving-data" class="md-nav__link">
    <span class="md-ellipsis">
      Saving Data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      API Documentation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Documentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio" class="md-nav__link">
    <span class="md-ellipsis">
      hdsemg_shared.fileio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.file_io" class="md-nav__link">
    <span class="md-ellipsis">
      file_io
    </span>
  </a>
  
    <nav class="md-nav" aria-label="file_io">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.file_io.load_file" class="md-nav__link">
    <span class="md-ellipsis">
      load_file()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.otb_4_file_io" class="md-nav__link">
    <span class="md-ellipsis">
      otb_4_file_io
    </span>
  </a>
  
    <nav class="md-nav" aria-label="otb_4_file_io">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.otb_4_file_io.load_otb4_file" class="md-nav__link">
    <span class="md-ellipsis">
      load_otb4_file()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.otb_4_file_io.parse_otb4_tracks_xml" class="md-nav__link">
    <span class="md-ellipsis">
      parse_otb4_tracks_xml()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.otb_4_file_io.read_novecento_plus" class="md-nav__link">
    <span class="md-ellipsis">
      read_novecento_plus()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.otb_4_file_io.read_standard_otb4" class="md-nav__link">
    <span class="md-ellipsis">
      read_standard_otb4()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.otb_plus_file_io" class="md-nav__link">
    <span class="md-ellipsis">
      otb_plus_file_io
    </span>
  </a>
  
    <nav class="md-nav" aria-label="otb_plus_file_io">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.otb_plus_file_io.build_channel_description" class="md-nav__link">
    <span class="md-ellipsis">
      build_channel_description()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.otb_plus_file_io.load_otb_file" class="md-nav__link">
    <span class="md-ellipsis">
      load_otb_file()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.otb_plus_file_io.parse_otb_xml" class="md-nav__link">
    <span class="md-ellipsis">
      parse_otb_xml()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdsemg_shared.fileio.otb_plus_file_io.scale_otb_data" class="md-nav__link">
    <span class="md-ellipsis">
      scale_otb_data()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="file-io">File I/O<a class="headerlink" href="#file-io" title="Permanent link">&para;</a></h1>
<p>The <code>fileio</code> module in <code>hdsemg-shared</code> provides unified, high-level functions for loading and saving high-density surface EMG (HD-sEMG) data from various file formats. It abstracts away the details of different vendor formats and provides a consistent interface for downstream processing.</p>
<hr />
<h2 id="supported-file-types">Supported File Types<a class="headerlink" href="#supported-file-types" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>MATLAB files</strong> (<code>.mat</code>):</li>
<li>Loads data, time, description, and sampling frequency from MATLAB files.</li>
<li><strong>OTB+ / OTB files</strong> (<code>.otb+</code>, <code>.otb</code>):</li>
<li>Handles OTB+ archives, including extraction, XML parsing, and signal scaling.</li>
<li><strong>OTB4 files</strong> (<code>.otb4</code>):</li>
<li>Supports OTB4 archives, including multi-track and device-specific handling.</li>
</ul>
<hr />
<h2 id="main-api-load_file">Main API: <code>load_file</code><a class="headerlink" href="#main-api-load_file" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">hdsemg_shared.fileio</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_file</span>

<span class="n">data</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">sampling_frequency</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_size</span> <span class="o">=</span> <span class="n">load_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
</code></pre></div>

<ul>
<li><strong><code>filepath</code></strong>: Path to the file to load (supports <code>.mat</code>, <code>.otb+</code>, <code>.otb</code>, <code>.otb4</code>).</li>
<li><strong>Returns</strong>: Tuple with data, time, description, sampling frequency, file name, and file size.</li>
</ul>
<p>The function automatically detects the file type and dispatches to the appropriate loader.</p>
<hr />
<h2 id="data-structure">Data Structure<a class="headerlink" href="#data-structure" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>data</strong>: <code>np.ndarray</code> (nSamples x nChannels), always returned as float for further processing.</li>
<li><strong>time</strong>: <code>np.ndarray</code> (nSamples,), time vector.</li>
<li><strong>description</strong>: Channel descriptions (array or list).</li>
<li><strong>sampling_frequency</strong>: Sampling frequency in Hz.</li>
<li><strong>file_name</strong>: Name of the loaded file.</li>
<li><strong>file_size</strong>: File size in bytes.</li>
</ul>
<hr />
<h2 id="example-usage">Example Usage<a class="headerlink" href="#example-usage" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">hdsemg_shared.fileio</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_file</span>

<span class="c1"># Load any supported file</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="s2">&quot;my_emg_data.otb+&quot;</span>
<span class="n">data</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">fsize</span> <span class="o">=</span> <span class="n">load_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2"> with shape </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> and fs=</span><span class="si">{</span><span class="n">fs</span><span class="si">}</span><span class="s2"> Hz&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="internal-structure">Internal Structure<a class="headerlink" href="#internal-structure" title="Permanent link">&para;</a></h2>
<ul>
<li>The <code>fileio</code> module delegates to specialized loaders:</li>
<li><code>matlab_file_io.py</code> for <code>.mat</code> files</li>
<li><code>otb_plus_file_io.py</code> for <code>.otb+</code> and <code>.otb</code> files</li>
<li><code>otb_4_file_io.py</code> for <code>.otb4</code> files</li>
<li>All loaders ensure data is returned in a consistent format and shape.</li>
<li>Data is always converted to float for compatibility with downstream processing.</li>
</ul>
<hr />
<h2 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h2>
<ul>
<li>Raises <code>ValueError</code> for unsupported file types.</li>
<li>Raises errors if file content is incompatible or missing required fields.</li>
</ul>
<hr />
<h2 id="saving-data">Saving Data<a class="headerlink" href="#saving-data" title="Permanent link">&para;</a></h2>
<p>Saving to <code>.mat</code> files is supported via:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">hdsemg_shared.fileio.matlab_file_io</span><span class="w"> </span><span class="kn">import</span> <span class="n">save_selection_to_mat</span>

<span class="n">save_selection_to_mat</span><span class="p">(</span><span class="n">save_file_path</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">sampling_frequency</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">grid_info</span><span class="p">)</span>
</code></pre></div>

<hr />
<blockquote>
<p>For more details, see the API documentation or the source code in <code>src/hdsemg_shared/fileio/</code>.</p>
</blockquote>
<hr />
<h2 id="api-documentation">API Documentation<a class="headerlink" href="#api-documentation" title="Permanent link">&para;</a></h2>


  <div class="doc doc-object doc-module">

<a id="hdsemg_shared.fileio"></a>
    <div class="doc doc-contents first">




  <div class="doc doc-children">










  <div class="doc doc-object doc-module">



<h3 id="hdsemg_shared.fileio.file_io" class="doc doc-heading">
        <code>file_io</code>



<a href="#hdsemg_shared.fileio.file_io" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h4 id="hdsemg_shared.fileio.file_io.load_file" class="doc doc-heading">
<code class=" language-python"><span class="n">load_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>


<a href="#hdsemg_shared.fileio.file_io.load_file" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Loads a file based on its file extension and extracts relevant data.</p>
<p>Supported file types:
- <code>.mat</code>: MATLAB files
- <code>.otb+</code>: OTB+ and related files
- <code>.otb4</code>: OTB4 and related files</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>filepath</code></td>
        <td><code>str</code></td>
        <td><p>The path to the file to be loaded.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>tuple</code></td>
      <td><p>A tuple containing:
    - data: The loaded data. (nSamples x nChannels)
    - time: The time information associated with the data. (nSamples,)
    - description: A description of the data.
    - sampling_frequency: The sampling frequency of the data.
    - file_name: The name of the file.
    - file_size: The size of the file.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>ValueError</code></td>
        <td><p>If the file type is unsupported.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>hdsemg_shared/fileio/file_io.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads a file based on its file extension and extracts relevant data.</span>

<span class="sd">    Supported file types:</span>
<span class="sd">    - `.mat`: MATLAB files</span>
<span class="sd">    - `.otb+`: OTB+ and related files</span>
<span class="sd">    - `.otb4`: OTB4 and related files</span>

<span class="sd">    Args:</span>
<span class="sd">        filepath (str): The path to the file to be loaded.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing:</span>
<span class="sd">            - data: The loaded data. (nSamples x nChannels)</span>
<span class="sd">            - time: The time information associated with the data. (nSamples,)</span>
<span class="sd">            - description: A description of the data.</span>
<span class="sd">            - sampling_frequency: The sampling frequency of the data.</span>
<span class="sd">            - file_name: The name of the file.</span>
<span class="sd">            - file_size: The size of the file.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the file type is unsupported.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_suffix</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span>
    <span class="k">if</span> <span class="n">file_suffix</span> <span class="o">==</span> <span class="s2">&quot;.mat&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">sampling_frequency</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_size</span> <span class="o">=</span> <span class="n">load_mat_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">file_suffix</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.otb+&quot;</span><span class="p">,</span> <span class="s2">&quot;.otb&quot;</span><span class="p">]:</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">sampling_frequency</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_size</span> <span class="o">=</span> <span class="n">load_otb_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">file_suffix</span> <span class="o">==</span> <span class="s2">&quot;.otb4&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">sampling_frequency</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_size</span> <span class="o">=</span> <span class="n">load_otb4_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported file type: </span><span class="si">{</span><span class="n">file_suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Handle case if data is int16 since we will run into issues with further processing</span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;int16&#39;</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="n">data</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">_sanitize_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">sampling_frequency</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_size</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>




  <div class="doc doc-object doc-module">



<h3 id="hdsemg_shared.fileio.otb_4_file_io" class="doc doc-heading">
        <code>otb_4_file_io</code>



<a href="#hdsemg_shared.fileio.otb_4_file_io" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">









  <div class="doc doc-object doc-function">



<h4 id="hdsemg_shared.fileio.otb_4_file_io.load_otb4_file" class="doc doc-heading">
<code class=" language-python"><span class="n">load_otb4_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>


<a href="#hdsemg_shared.fileio.otb_4_file_io.load_otb4_file" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Load and process an OTB4 file.</p>
<p>This function handles the extraction of the OTB4 file, validates its contents,
parses the associated XML file, and processes signal data. It returns the
processed data, time array, descriptions, sampling frequency, file name, and
file size.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>file_path</code></td>
        <td><code>str</code></td>
        <td><p>Path to the OTB4 file to be loaded.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>tuple</code></td>
      <td><p>A tuple containing:
    - data (numpy.ndarray): Processed signal data.
    - time (numpy.ndarray): Time array corresponding to the data.
    - description_array (numpy.ndarray): Array of channel descriptions.
    - sampling_frequency (float): Sampling frequency of the signals.
    - file_name (str): Name of the OTB4 file.
    - file_size (int): Size of the OTB4 file in bytes.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>ValueError</code></td>
        <td><p>If the OTB4 file format is unrecognized or if no track info is found.</p></td>
      </tr>
      <tr>
        <td><code>FileNotFoundError</code></td>
        <td><p>If the required XML file is missing.</p></td>
      </tr>
      <tr>
        <td><code>RuntimeError</code></td>
        <td><p>If the extraction of the OTB4 file fails.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>hdsemg_shared/fileio/otb_4_file_io.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_otb4_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load and process an OTB4 file.</span>

<span class="sd">    This function handles the extraction of the OTB4 file, validates its contents,</span>
<span class="sd">    parses the associated XML file, and processes signal data. It returns the</span>
<span class="sd">    processed data, time array, descriptions, sampling frequency, file name, and</span>
<span class="sd">    file size.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path (str): Path to the OTB4 file to be loaded.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing:</span>
<span class="sd">            - data (numpy.ndarray): Processed signal data.</span>
<span class="sd">            - time (numpy.ndarray): Time array corresponding to the data.</span>
<span class="sd">            - description_array (numpy.ndarray): Array of channel descriptions.</span>
<span class="sd">            - sampling_frequency (float): Sampling frequency of the signals.</span>
<span class="sd">            - file_name (str): Name of the OTB4 file.</span>
<span class="sd">            - file_size (int): Size of the OTB4 file in bytes.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the OTB4 file format is unrecognized or if no track info is found.</span>
<span class="sd">        FileNotFoundError: If the required XML file is missing.</span>
<span class="sd">        RuntimeError: If the extraction of the OTB4 file fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;load_otb4_file called with file_path=</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file_path_obj</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">file_path_obj</span><span class="o">.</span><span class="n">name</span>
    <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="n">tmpdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;otb4_tmp_&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created temp directory: </span><span class="si">{</span><span class="n">tmpdir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Attempt to extract .otb4 (which presumably is a tar or zip)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">is_tarfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
                <span class="n">t</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">tmpdir</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">is_zipfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">z</span><span class="p">:</span>
                <span class="n">z</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">tmpdir</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;OTB4 file is neither recognized as tar nor zip.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized OTB4 archive format.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extraction failed for </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to extract OTB4 file: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

    <span class="c1"># Look for &quot;Tracks_000.xml&quot; - as in your .m code</span>
    <span class="n">tracks_xml</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="s2">&quot;Tracks_000.xml&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tracks_xml</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing &#39;Tracks_000.xml&#39; in extracted OTB4 folder: </span><span class="si">{</span><span class="n">tmpdir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;No Tracks_000.xml found for OTB4 data.&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parsing OTB4 XML: </span><span class="si">{</span><span class="n">tracks_xml</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">track_info_list</span> <span class="o">=</span> <span class="n">parse_otb4_tracks_xml</span><span class="p">(</span><span class="n">tracks_xml</span><span class="p">)</span>  <span class="c1"># We&#39;ll define below</span>

    <span class="c1"># We&#39;ll also list .sig files in tmpdir</span>
    <span class="n">signals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.sig&quot;</span><span class="p">):</span>
                <span class="n">signals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found .sig files for OTB4: </span><span class="si">{</span><span class="n">signals</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Now, let&#39;s gather info from track_info_list. e.g. sum up channels, detect device type, etc.</span>
    <span class="c1"># The .m code references `device = textscan(...)` from the first track. We&#39;ll replicate that:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">track_info_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No &lt;TrackInfo&gt; found in Tracks_000.xml. Can&#39;t proceed.&quot;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No track info in OTB4 xml.&quot;</span><span class="p">)</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">track_info_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Device&quot;</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OTB4 device name: </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Sum total channels from track_info</span>
    <span class="n">total_channels</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="s2">&quot;NumberOfChannels&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">track_info_list</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total channels from tracks: </span><span class="si">{</span><span class="n">total_channels</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">device</span> <span class="o">==</span> <span class="s2">&quot;Novecento+&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">descriptions</span><span class="p">,</span> <span class="n">fs_main</span> <span class="o">=</span> <span class="n">read_novecento_plus</span><span class="p">(</span><span class="n">signals</span><span class="p">,</span> <span class="n">track_info_list</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">descriptions</span><span class="p">,</span> <span class="n">fs_main</span> <span class="o">=</span> <span class="n">read_standard_otb4</span><span class="p">(</span><span class="n">signals</span><span class="p">,</span> <span class="n">track_info_list</span><span class="p">)</span>

    <span class="n">description_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">desc</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;&lt;U</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)]</span> <span class="k">for</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">descriptions</span><span class="p">],</span>
        <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span>
    <span class="p">)</span>

    <span class="n">sampling_frequency</span> <span class="o">=</span> <span class="n">fs_main</span>

    <span class="n">n_samples</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)</span> <span class="o">/</span> <span class="n">sampling_frequency</span>

    <span class="c1"># clean up</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OTB4 file loaded successfully: </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># make sure that the data array is in the shape (time, shape)</span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Transposing data array since it is in the wrong shape&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">T</span>


    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">description_array</span><span class="p">,</span> <span class="n">sampling_frequency</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_size</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="hdsemg_shared.fileio.otb_4_file_io.parse_otb4_tracks_xml" class="doc doc-heading">
<code class=" language-python"><span class="n">parse_otb4_tracks_xml</span><span class="p">(</span><span class="n">xml_file</span><span class="p">)</span></code>


<a href="#hdsemg_shared.fileio.otb_4_file_io.parse_otb4_tracks_xml" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Parse 'Tracks_000.xml' to gather arrayOfTrackInfo.
Returns a list of dictionaries, z. B.:
  [{
      "Device": "Novecento+",
      "Gain": ...,
      "ADC_Nbits": ...,
      "ADC_Range": ...,
      "SamplingFrequency": ...,
      "SignalStreamPath": "...",
      "NumberOfChannels": ...,
      "AcquisitionChannel": ...,
      "SubTitle": ...   # &lt;-- Grid identifier
    }, ... ]</p>

        <details class="quote">
          <summary>Source code in <code>hdsemg_shared/fileio/otb_4_file_io.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_otb4_tracks_xml</span><span class="p">(</span><span class="n">xml_file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse &#39;Tracks_000.xml&#39; to gather arrayOfTrackInfo.</span>
<span class="sd">    Returns a list of dictionaries, z. B.:</span>
<span class="sd">      [{</span>
<span class="sd">          &quot;Device&quot;: &quot;Novecento+&quot;,</span>
<span class="sd">          &quot;Gain&quot;: ...,</span>
<span class="sd">          &quot;ADC_Nbits&quot;: ...,</span>
<span class="sd">          &quot;ADC_Range&quot;: ...,</span>
<span class="sd">          &quot;SamplingFrequency&quot;: ...,</span>
<span class="sd">          &quot;SignalStreamPath&quot;: &quot;...&quot;,</span>
<span class="sd">          &quot;NumberOfChannels&quot;: ...,</span>
<span class="sd">          &quot;AcquisitionChannel&quot;: ...,</span>
<span class="sd">          &quot;SubTitle&quot;: ...   # &lt;-- Grid identifier</span>
<span class="sd">        }, ... ]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">xml_file</span><span class="p">)</span>
    <span class="n">track_info_parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">track_info_parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># Finde die &lt;TrackInfo&gt;-Elemente</span>
    <span class="n">track_info_elems</span> <span class="o">=</span> <span class="n">track_info_parent</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;TrackInfo&quot;</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tr_el</span> <span class="ow">in</span> <span class="n">track_info_elems</span><span class="p">:</span>
        <span class="n">device_str</span> <span class="o">=</span> <span class="n">_get_text_save</span><span class="p">(</span><span class="n">tr_el</span><span class="p">,</span> <span class="s2">&quot;Device&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span> <span class="n">do_strip</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">gain_str</span> <span class="o">=</span> <span class="n">_get_text_save</span><span class="p">(</span><span class="n">tr_el</span><span class="p">,</span> <span class="s2">&quot;Gain&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">do_strip</span><span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">bits_str</span> <span class="o">=</span> <span class="n">_get_text_save</span><span class="p">(</span><span class="n">tr_el</span><span class="p">,</span> <span class="s2">&quot;ADC_Nbits&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;16&quot;</span><span class="p">,</span> <span class="n">do_strip</span><span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">rng_str</span> <span class="o">=</span> <span class="n">_get_text_save</span><span class="p">(</span><span class="n">tr_el</span><span class="p">,</span> <span class="s2">&quot;ADC_Range&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="n">do_strip</span><span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">fs_str</span> <span class="o">=</span> <span class="n">_get_text_save</span><span class="p">(</span><span class="n">tr_el</span><span class="p">,</span> <span class="s2">&quot;SamplingFrequency&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;2000&quot;</span><span class="p">,</span> <span class="n">do_strip</span><span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">path_str</span> <span class="o">=</span> <span class="n">_get_text_save</span><span class="p">(</span><span class="n">tr_el</span><span class="p">,</span> <span class="s2">&quot;SignalStreamPath&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">do_strip</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">nchan_str</span> <span class="o">=</span> <span class="n">_get_text_save</span><span class="p">(</span><span class="n">tr_el</span><span class="p">,</span> <span class="s2">&quot;NumberOfChannels&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="n">do_strip</span><span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">acq_str</span> <span class="o">=</span> <span class="n">_get_text_save</span><span class="p">(</span><span class="n">tr_el</span><span class="p">,</span> <span class="s2">&quot;AcquisitionChannel&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="n">do_strip</span><span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">subtitle_str</span> <span class="o">=</span> <span class="n">_get_text_save</span><span class="p">(</span><span class="n">tr_el</span><span class="p">,</span> <span class="s2">&quot;SubTitle&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span> <span class="n">do_strip</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Konvertierungen</span>
        <span class="n">gain_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">gain_str</span><span class="p">)</span>
        <span class="n">bits_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bits_str</span><span class="p">)</span>
        <span class="n">rng_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rng_str</span><span class="p">)</span>
        <span class="n">fs_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fs_str</span><span class="p">)</span>
        <span class="n">nchan_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nchan_str</span><span class="p">)</span>
        <span class="n">acq_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">acq_str</span><span class="p">)</span>

        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;Device&quot;</span><span class="p">:</span> <span class="n">device_str</span><span class="p">,</span>
            <span class="s2">&quot;Gain&quot;</span><span class="p">:</span> <span class="n">gain_val</span><span class="p">,</span>
            <span class="s2">&quot;ADC_Nbits&quot;</span><span class="p">:</span> <span class="n">bits_val</span><span class="p">,</span>
            <span class="s2">&quot;ADC_Range&quot;</span><span class="p">:</span> <span class="n">rng_val</span><span class="p">,</span>
            <span class="s2">&quot;SamplingFrequency&quot;</span><span class="p">:</span> <span class="n">fs_val</span><span class="p">,</span>
            <span class="s2">&quot;SignalStreamPath&quot;</span><span class="p">:</span> <span class="n">path_str</span><span class="p">,</span>
            <span class="s2">&quot;NumberOfChannels&quot;</span><span class="p">:</span> <span class="n">nchan_val</span><span class="p">,</span>
            <span class="s2">&quot;AcquisitionChannel&quot;</span><span class="p">:</span> <span class="n">acq_val</span><span class="p">,</span>
            <span class="s2">&quot;SubTitle&quot;</span><span class="p">:</span> <span class="n">subtitle_str</span>  <span class="c1"># Grid identifier</span>
        <span class="p">})</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="hdsemg_shared.fileio.otb_4_file_io.read_novecento_plus" class="doc doc-heading">
<code class=" language-python"><span class="n">read_novecento_plus</span><span class="p">(</span><span class="n">signals</span><span class="p">,</span> <span class="n">track_info_list</span><span class="p">)</span></code>


<a href="#hdsemg_shared.fileio.otb_4_file_io.read_novecento_plus" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>For the 'Novecento+' device, the .m code loops multiple signals,
tries to match Path, sets Gains, etc., and reads data as 'int32'.
We'll unify them and return final (data, descriptions, fs).
For demonstration, we assume each .sig is separate chunk of channels.</p>

        <details class="quote">
          <summary>Source code in <code>hdsemg_shared/fileio/otb_4_file_io.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_novecento_plus</span><span class="p">(</span><span class="n">signals</span><span class="p">,</span> <span class="n">track_info_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For the &#39;Novecento+&#39; device, the .m code loops multiple signals,</span>
<span class="sd">    tries to match Path, sets Gains, etc., and reads data as &#39;int32&#39;.</span>
<span class="sd">    We&#39;ll unify them and return final (data, descriptions, fs).</span>
<span class="sd">    For demonstration, we assume each .sig is separate chunk of channels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;read_novecento_plus routine&quot;</span><span class="p">)</span>
    <span class="c1"># We&#39;ll create a big list of channel blocks</span>
    <span class="n">data_blocks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">descriptions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fs_main</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">sig_path</span> <span class="ow">in</span> <span class="n">signals</span><span class="p">:</span>
        <span class="c1"># find track that references this sig file</span>
        <span class="n">matched_track</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">track_info_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tr</span><span class="p">[</span><span class="s2">&quot;SignalStreamPath&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">sig_path</span><span class="p">):</span>
                <span class="n">matched_track</span> <span class="o">=</span> <span class="n">tr</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">matched_track</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># skip</span>
            <span class="k">continue</span>

        <span class="n">n_ch</span> <span class="o">=</span> <span class="n">matched_track</span><span class="p">[</span><span class="s2">&quot;NumberOfChannels&quot;</span><span class="p">]</span>
        <span class="c1"># read raw as int32</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">sig_path</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">size</span> <span class="o">//</span> <span class="n">n_ch</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">raw</span><span class="p">[:</span><span class="n">samples</span> <span class="o">*</span> <span class="n">n_ch</span><span class="p">]</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n_ch</span><span class="p">,</span> <span class="n">samples</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>

        <span class="c1"># scale</span>
        <span class="c1"># data(Ch,:)=data(Ch,:)*Psup/(2^ADbit)*1000/Gain</span>
        <span class="n">conv</span> <span class="o">=</span> <span class="n">matched_track</span><span class="p">[</span><span class="s2">&quot;ADC_Range&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">matched_track</span><span class="p">[</span><span class="s2">&quot;ADC_Nbits&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">matched_track</span><span class="p">[</span><span class="s2">&quot;Gain&quot;</span><span class="p">]</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">*</span> <span class="n">conv</span>

        <span class="n">data_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>

        <span class="c1"># keep track of fs</span>
        <span class="k">if</span> <span class="n">fs_main</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fs_main</span> <span class="o">=</span> <span class="n">matched_track</span><span class="p">[</span><span class="s2">&quot;SamplingFrequency&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if you want to check consistency:</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fs_main</span> <span class="o">-</span> <span class="n">matched_track</span><span class="p">[</span><span class="s2">&quot;SamplingFrequency&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">1e-9</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Inconsistent sampling freq among tracks?&quot;</span><span class="p">)</span>

        <span class="c1"># build placeholder descriptions:</span>
        <span class="c1"># e.g. &quot;Novecento+ &lt;SignalStreamPath&gt; channel x&quot;</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_ch</span><span class="p">):</span>
            <span class="n">dev</span> <span class="o">=</span> <span class="n">matched_track</span><span class="p">[</span><span class="s1">&#39;Device&#39;</span><span class="p">]</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="n">matched_track</span><span class="p">[</span><span class="s1">&#39;SignalStreamPath&#39;</span><span class="p">]</span>
            <span class="n">grid_id</span> <span class="o">=</span> <span class="n">matched_track</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SubTitle&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">)</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dev</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">sig</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">grid_id</span><span class="si">}</span><span class="s2">-ch</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">descriptions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span>

    <span class="n">lens</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">data_blocks</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="n">lens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lens</span><span class="p">):</span>
        <span class="c1"># mismatch sample counts =&gt; handle or raise</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Different sample lengths among signals. We&#39;ll pick min length.&quot;</span><span class="p">)</span>
        <span class="n">min_len</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lens</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_blocks</span><span class="p">)):</span>
            <span class="n">data_blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_blocks</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span> <span class="p">:</span><span class="n">min_len</span><span class="p">]</span>

    <span class="c1"># vstack them</span>
    <span class="n">final_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">data_blocks</span><span class="p">)</span> <span class="k">if</span> <span class="n">data_blocks</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">final_data</span><span class="p">,</span> <span class="n">descriptions</span><span class="p">,</span> <span class="n">fs_main</span> <span class="ow">or</span> <span class="mi">2000</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="hdsemg_shared.fileio.otb_4_file_io.read_standard_otb4" class="doc doc-heading">
<code class=" language-python"><span class="n">read_standard_otb4</span><span class="p">(</span><span class="n">signals</span><span class="p">,</span> <span class="n">track_info_list</span><span class="p">)</span></code>


<a href="#hdsemg_shared.fileio.otb_4_file_io.read_standard_otb4" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>We read the <em>first</em> .sig using 'short' if so indicated,
then apply Gains for each track in partial channel intervals.</p>

        <details class="quote">
          <summary>Source code in <code>hdsemg_shared/fileio/otb_4_file_io.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_standard_otb4</span><span class="p">(</span><span class="n">signals</span><span class="p">,</span> <span class="n">track_info_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    We read the *first* .sig using &#39;short&#39; if so indicated,</span>
<span class="sd">    then apply Gains for each track in partial channel intervals.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;read_standard_otb4 routine&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">signals</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">[],</span> <span class="mf">2000.0</span>

    <span class="n">sig_path</span> <span class="o">=</span> <span class="n">signals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># the .m code uses the first .sig</span>
    <span class="c1"># sum up totalCh</span>
    <span class="n">totalCh</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tr</span><span class="p">[</span><span class="s2">&quot;NumberOfChannels&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">track_info_list</span><span class="p">)</span>
    <span class="c1"># read &#39;short&#39; =&gt; int16</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">sig_path</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">size</span> <span class="o">//</span> <span class="n">totalCh</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="n">raw</span><span class="p">[:</span><span class="n">samples</span> <span class="o">*</span> <span class="n">totalCh</span><span class="p">]</span>
    <span class="n">data_2d</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">totalCh</span><span class="p">,</span> <span class="n">samples</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="n">indexes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">running_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">track_info_list</span><span class="p">:</span>
        <span class="n">running_sum</span> <span class="o">+=</span> <span class="n">tr</span><span class="p">[</span><span class="s2">&quot;NumberOfChannels&quot;</span><span class="p">]</span>
        <span class="n">indexes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">running_sum</span><span class="p">)</span>


    <span class="n">start_idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">trackinfo</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">track_info_list</span><span class="p">):</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="n">indexes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">psup</span> <span class="o">=</span> <span class="n">trackinfo</span><span class="p">[</span><span class="s2">&quot;ADC_Range&quot;</span><span class="p">]</span>
        <span class="n">nbits</span> <span class="o">=</span> <span class="n">trackinfo</span><span class="p">[</span><span class="s2">&quot;ADC_Nbits&quot;</span><span class="p">]</span>
        <span class="n">gainv</span> <span class="o">=</span> <span class="n">trackinfo</span><span class="p">[</span><span class="s2">&quot;Gain&quot;</span><span class="p">]</span>
        <span class="n">conv</span> <span class="o">=</span> <span class="n">psup</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">nbits</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1000.0</span> <span class="o">/</span> <span class="n">gainv</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">):</span>
            <span class="n">data_2d</span><span class="p">[</span><span class="n">ch</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*=</span> <span class="n">conv</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="n">end_idx</span>

    <span class="c1"># build description strings</span>
    <span class="n">descriptions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">track_info_list</span><span class="p">:</span>
        <span class="n">dev</span> <span class="o">=</span> <span class="n">tr</span><span class="p">[</span><span class="s2">&quot;Device&quot;</span><span class="p">]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">tr</span><span class="p">[</span><span class="s2">&quot;SignalStreamPath&quot;</span><span class="p">]</span>
        <span class="n">grid_id</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SubTitle&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">)</span>
        <span class="n">nchan</span> <span class="o">=</span> <span class="n">tr</span><span class="p">[</span><span class="s2">&quot;NumberOfChannels&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nchan</span><span class="p">):</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dev</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">grid_id</span><span class="si">}</span><span class="s2">-ch</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">descriptions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span>

    <span class="c1"># the .m code picks the sample freq from e.g. Fsample{nSig}, presumably from the first track</span>
    <span class="n">fs_main</span> <span class="o">=</span> <span class="n">track_info_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;SamplingFrequency&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">track_info_list</span> <span class="k">else</span> <span class="mf">2000.0</span>


    <span class="k">return</span> <span class="n">data_2d</span><span class="p">,</span> <span class="n">descriptions</span><span class="p">,</span> <span class="n">fs_main</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="hdsemg_shared.fileio.otb_plus_file_io" class="doc doc-heading">
        <code>otb_plus_file_io</code>



<a href="#hdsemg_shared.fileio.otb_plus_file_io" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">









  <div class="doc doc-object doc-function">



<h4 id="hdsemg_shared.fileio.otb_plus_file_io.build_channel_description" class="doc doc-heading">
<code class=" language-python"><span class="n">build_channel_description</span><span class="p">(</span><span class="n">adapter_id</span><span class="p">,</span> <span class="n">adapter_desc</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">descr</span><span class="p">,</span> <span class="n">muscle</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span></code>


<a href="#hdsemg_shared.fileio.otb_plus_file_io.build_channel_description" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Combine attributes for a channel description, skipping empty or placeholders like 'Not defined'.</p>

        <details class="quote">
          <summary>Source code in <code>hdsemg_shared/fileio/otb_plus_file_io.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_channel_description</span><span class="p">(</span><span class="n">adapter_id</span><span class="p">,</span> <span class="n">adapter_desc</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">descr</span><span class="p">,</span> <span class="n">muscle</span><span class="p">,</span> <span class="n">side</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Combine attributes for a channel description, skipping empty or placeholders like &#39;Not defined&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">adapter_id</span><span class="p">,</span> <span class="n">adapter_desc</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">descr</span><span class="p">,</span> <span class="n">muscle</span><span class="p">,</span> <span class="n">side</span><span class="p">]</span>
    <span class="c1"># Filter out empty strings or &#39;Not defined&#39;</span>
    <span class="n">filtered_fields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">and</span> <span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;not defined&quot;</span><span class="p">:</span>
            <span class="c1"># Also strip leading/trailing spaces</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">filtered_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="c1"># Join using dashes</span>
    <span class="k">return</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filtered_fields</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="hdsemg_shared.fileio.otb_plus_file_io.load_otb_file" class="doc doc-heading">
<code class=" language-python"><span class="n">load_otb_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>


<a href="#hdsemg_shared.fileio.otb_plus_file_io.load_otb_file" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Loads data from a single .otb (or .otb+ / .zip / .tar) archive and returns
(data, time, description, sampling_frequency, file_name, file_size).</p>

        <details class="quote">
          <summary>Source code in <code>hdsemg_shared/fileio/otb_plus_file_io.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_otb_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads data from a single .otb (or .otb+ / .zip / .tar) archive and returns</span>
<span class="sd">    (data, time, description, sampling_frequency, file_name, file_size).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;load_otb_file called with file_path=</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file_path_obj</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">file_path_obj</span><span class="o">.</span><span class="n">name</span>
    <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File info: name=</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">, size=</span><span class="si">{</span><span class="n">file_size</span><span class="si">}</span><span class="s2"> bytes&quot;</span><span class="p">)</span>

    <span class="n">tmpdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;otb_tmp_&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created temp directory: </span><span class="si">{</span><span class="n">tmpdir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Try extracting</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">is_tarfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;File appears to be a TAR archive&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
                <span class="n">t</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">tmpdir</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">is_zipfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;File appears to be a ZIP archive&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">z</span><span class="p">:</span>
                <span class="n">z</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">tmpdir</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;File is neither recognized as tar nor zip. Possibly custom format.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The file does not appear to be tar or zip. Check OTB format.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extraction failed for </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to extract </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># search for .sig</span>
    <span class="n">found_sig</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.sig&quot;</span><span class="p">):</span>
                <span class="n">fullp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
                <span class="n">found_sig</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fullp</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found .sig files: </span><span class="si">{</span><span class="n">found_sig</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">found_sig</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No .sig files found after extracting.&quot;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;No .sig files found in the extracted OTB archive.&quot;</span><span class="p">)</span>

    <span class="n">sig_file</span> <span class="o">=</span> <span class="n">found_sig</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using first .sig file: </span><span class="si">{</span><span class="n">sig_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">xml_file</span> <span class="o">=</span> <span class="n">sig_file</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.xml&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">xml_file</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected XML not found: </span><span class="si">{</span><span class="n">xml_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find the matching XML for </span><span class="si">{</span><span class="n">sig_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parsing XML: </span><span class="si">{</span><span class="n">xml_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">info_dict</span> <span class="o">=</span> <span class="n">parse_otb_xml</span><span class="p">(</span><span class="n">xml_file</span><span class="p">)</span>

    <span class="n">n_channels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">info_dict</span><span class="p">[</span><span class="s2">&quot;Gains&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="n">info_dict</span><span class="p">[</span><span class="s2">&quot;Gains&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="n">nADbits</span> <span class="o">=</span> <span class="n">info_dict</span><span class="p">[</span><span class="s2">&quot;ADbits&quot;</span><span class="p">]</span>
    <span class="n">raw_data</span> <span class="o">=</span> <span class="n">load_sig_data</span><span class="p">(</span><span class="n">sig_file</span><span class="p">,</span> <span class="n">n_channels</span><span class="p">,</span> <span class="n">nADbits</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded .sig data shape=</span><span class="si">{</span><span class="n">raw_data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">data_scaled</span> <span class="o">=</span> <span class="n">scale_otb_data</span><span class="p">(</span><span class="n">raw_data</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">[</span><span class="s2">&quot;Gains&quot;</span><span class="p">],</span> <span class="n">nADbits</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">[</span><span class="s2">&quot;DeviceName&quot;</span><span class="p">],</span> <span class="n">adapter_types</span><span class="o">=</span><span class="n">info_dict</span><span class="p">[</span><span class="s2">&quot;AdapterTypes&quot;</span><span class="p">])</span>
    <span class="n">sampling_frequency</span> <span class="o">=</span> <span class="n">info_dict</span><span class="p">[</span><span class="s2">&quot;SampleFrequency&quot;</span><span class="p">]</span>
    <span class="n">n_samples</span> <span class="o">=</span> <span class="n">data_scaled</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)</span> <span class="o">/</span> <span class="n">sampling_frequency</span>

    <span class="c1"># descriptions - convert to ndarray with shape (nChannels, 1)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">desc</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;&lt;U</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)]</span> <span class="k">for</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;ChannelDescriptions&#39;</span><span class="p">]],</span>
        <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span>
    <span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cleaning up temp directory </span><span class="si">{</span><span class="n">tmpdir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OTB file loaded successfully: </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data_scaled</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">sampling_frequency</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_size</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-function">



<h4 id="hdsemg_shared.fileio.otb_plus_file_io.parse_otb_xml" class="doc doc-heading">
<code class=" language-python"><span class="n">parse_otb_xml</span><span class="p">(</span><span class="n">xml_file</span><span class="p">)</span></code>


<a href="#hdsemg_shared.fileio.otb_plus_file_io.parse_otb_xml" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Parse .otb XML and create a Gains array plus a ChannelDescriptions list,
each of length 'DeviceTotalChannels'. Now includes adapter-based info
in the channel description string.</p>
<p>Returns a dict:
  {
    "DeviceName": str,
    "SampleFrequency": float,
    "ADbits": int,
    "TotalChannels": int,
    "Gains": list(float),
    "ChannelDescriptions": list(str)
  }</p>

        <details class="quote">
          <summary>Source code in <code>hdsemg_shared/fileio/otb_plus_file_io.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_otb_xml</span><span class="p">(</span><span class="n">xml_file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse .otb XML and create a Gains array plus a ChannelDescriptions list,</span>
<span class="sd">    each of length &#39;DeviceTotalChannels&#39;. Now includes adapter-based info</span>
<span class="sd">    in the channel description string.</span>

<span class="sd">    Returns a dict:</span>
<span class="sd">      {</span>
<span class="sd">        &quot;DeviceName&quot;: str,</span>
<span class="sd">        &quot;SampleFrequency&quot;: float,</span>
<span class="sd">        &quot;ADbits&quot;: int,</span>
<span class="sd">        &quot;TotalChannels&quot;: int,</span>
<span class="sd">        &quot;Gains&quot;: list(float),</span>
<span class="sd">        &quot;ChannelDescriptions&quot;: list(str)</span>
<span class="sd">      }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">xml_file</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>

    <span class="n">device_name</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;UnknownDevice&quot;</span><span class="p">)</span>
    <span class="n">fs_str</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SampleFrequency&quot;</span><span class="p">,</span> <span class="s2">&quot;2000&quot;</span><span class="p">)</span>
    <span class="n">adbits_str</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ad_bits&quot;</span><span class="p">,</span> <span class="s2">&quot;16&quot;</span><span class="p">)</span>
    <span class="n">total_ch_str</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DeviceTotalChannels&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">total_ch</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">total_ch_str</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">total_ch</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">total_ch</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">total_ch</span> <span class="o">=</span> <span class="mi">128</span>  <span class="c1"># fallback</span>

    <span class="n">adapter_ids</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span>  <span class="p">]</span> <span class="o">*</span> <span class="n">total_ch</span>

    <span class="n">Gains</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">total_ch</span>
    <span class="n">description_map</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">total_ch</span>
    <span class="n">adapter_type_map</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">total_ch</span>

    <span class="c1"># Now parse each &lt;Adapter&gt; in &lt;Channels&gt;</span>
    <span class="n">channels_el</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Channels&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">channels_el</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">adapters_list</span> <span class="o">=</span> <span class="n">channels_el</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Adapter&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">adapterEl</span> <span class="ow">in</span> <span class="n">adapters_list</span><span class="p">:</span>
            <span class="c1"># read adapter-level gain</span>
            <span class="n">adapter_gain_str</span> <span class="o">=</span> <span class="n">adapterEl</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Gain&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>
            <span class="n">adapter_gain</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">adapter_gain_str</span><span class="p">)</span>

            <span class="c1"># read adapter-level start index</span>
            <span class="n">start_index_str</span> <span class="o">=</span> <span class="n">adapterEl</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ChannelStartIndex&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>
            <span class="n">start_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_index_str</span><span class="p">)</span>

            <span class="c1"># Also fetch additional attributes at the adapter level</span>
            <span class="n">adapter_id</span> <span class="o">=</span> <span class="n">adapterEl</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">adapter_desc</span> <span class="o">=</span> <span class="n">adapterEl</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">adapter_type</span> <span class="o">=</span> <span class="n">adapterEl</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="n">adapterEl</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

            <span class="c1"># find &lt;Channel&gt; children</span>
            <span class="n">channel_els</span> <span class="o">=</span> <span class="n">adapterEl</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;Channel&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ch_el</span> <span class="ow">in</span> <span class="n">channel_els</span><span class="p">:</span>
                <span class="n">ch_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ch_el</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Index&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">))</span>

                <span class="c1"># Extract channel-level gain if present, else use adapter gain</span>
                <span class="n">ch_gain_str</span> <span class="o">=</span> <span class="n">ch_el</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Gain&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ch_gain_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ch_gain</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ch_gain_str</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ch_gain</span> <span class="o">=</span> <span class="n">adapter_gain</span>

                <span class="c1"># Additional channel-level attributes</span>
                <span class="n">cid</span> <span class="o">=</span> <span class="n">ch_el</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="n">ch_el</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Prefix&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">descr</span> <span class="o">=</span> <span class="n">ch_el</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">muscle</span> <span class="o">=</span> <span class="n">ch_el</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Muscle&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">side</span> <span class="o">=</span> <span class="n">ch_el</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Side&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="n">ch_description</span> <span class="o">=</span> <span class="n">build_channel_description</span><span class="p">(</span>
                    <span class="n">adapter_id</span><span class="p">,</span> <span class="n">adapter_desc</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">descr</span><span class="p">,</span> <span class="n">muscle</span><span class="p">,</span> <span class="n">side</span>
                <span class="p">)</span>

                <span class="n">abs_ch</span> <span class="o">=</span> <span class="n">start_index</span> <span class="o">+</span> <span class="n">ch_index</span>
                <span class="n">adapter_type_map</span><span class="p">[</span><span class="n">abs_ch</span><span class="p">]</span> <span class="o">=</span> <span class="n">adapter_type</span>
                <span class="n">Gains</span><span class="p">[</span><span class="n">abs_ch</span><span class="p">]</span> <span class="o">=</span> <span class="n">adapter_gain</span> <span class="o">*</span> <span class="n">ch_gain</span>  <span class="c1"># Multipliziere Adapter- und Channel-Gain</span>
                <span class="n">description_map</span><span class="p">[</span><span class="n">abs_ch</span><span class="p">]</span> <span class="o">=</span> <span class="n">ch_description</span>
                <span class="n">adapter_ids</span><span class="p">[</span><span class="n">abs_ch</span><span class="p">]</span> <span class="o">=</span> <span class="n">adapter_id</span>

    <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;DeviceName&quot;</span><span class="p">:</span> <span class="n">device_name</span><span class="p">,</span>
        <span class="s2">&quot;SampleFrequency&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">fs_str</span><span class="p">),</span>
        <span class="s2">&quot;ADbits&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">adbits_str</span><span class="p">),</span>
        <span class="s2">&quot;TotalChannels&quot;</span><span class="p">:</span> <span class="n">total_ch</span><span class="p">,</span>
        <span class="s2">&quot;Gains&quot;</span><span class="p">:</span> <span class="n">Gains</span><span class="p">,</span>
        <span class="s2">&quot;ChannelDescriptions&quot;</span><span class="p">:</span> <span class="n">description_map</span><span class="p">,</span>
        <span class="s2">&quot;AdapterIDs&quot;</span><span class="p">:</span> <span class="n">adapter_ids</span><span class="p">,</span>
        <span class="s2">&quot;AdapterTypes&quot;</span><span class="p">:</span> <span class="n">adapter_type_map</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">info</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="hdsemg_shared.fileio.otb_plus_file_io.scale_otb_data" class="doc doc-heading">
<code class=" language-python"><span class="n">scale_otb_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">gains</span><span class="p">,</span> <span class="n">nADbits</span><span class="p">,</span> <span class="n">device_name</span><span class="p">,</span> <span class="n">adapter_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">power_supplies</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#hdsemg_shared.fileio.otb_plus_file_io.scale_otb_data" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Skaliert OTB+ Rohdaten wie in der MATLAB-Referenz:
data: np.ndarray, shape (n_channels, n_samples)
gains: list/array, Gain pro Kanal (aus XML)
nADbits: int, z.B. 16
device_name: str, z.B. 'SyncStation', 'Quattro', ...
adapter_types: list/array, Adapter-Typ pro Kanal (aus XML)
power_supplies: list/array, PowerSupply pro Kanal (optional, sonst Default 4.8)</p>

        <details class="quote">
          <summary>Source code in <code>hdsemg_shared/fileio/otb_plus_file_io.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">scale_otb_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">gains</span><span class="p">,</span> <span class="n">nADbits</span><span class="p">,</span> <span class="n">device_name</span><span class="p">,</span> <span class="n">adapter_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">power_supplies</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Skaliert OTB+ Rohdaten wie in der MATLAB-Referenz:</span>
<span class="sd">    data: np.ndarray, shape (n_channels, n_samples)</span>
<span class="sd">    gains: list/array, Gain pro Kanal (aus XML)</span>
<span class="sd">    nADbits: int, z.B. 16</span>
<span class="sd">    device_name: str, z.B. &#39;SyncStation&#39;, &#39;Quattro&#39;, ...</span>
<span class="sd">    adapter_types: list/array, Adapter-Typ pro Kanal (aus XML)</span>
<span class="sd">    power_supplies: list/array, PowerSupply pro Kanal (optional, sonst Default 4.8)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>  <span class="c1"># Prepare for scaling</span>
    <span class="n">n_ch</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">adapter_types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">adapter_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_ch</span>
    <span class="k">if</span> <span class="n">power_supplies</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">power_supplies</span> <span class="o">=</span> <span class="p">[</span><span class="mf">4.8</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_ch</span>
    <span class="n">dev</span> <span class="o">=</span> <span class="n">device_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start channel scaling: n_channels=</span><span class="si">{</span><span class="n">n_ch</span><span class="si">}</span><span class="s2">, nADbits=</span><span class="si">{</span><span class="n">nADbits</span><span class="si">}</span><span class="s2">, device=</span><span class="si">{</span><span class="n">dev</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_ch</span><span class="p">):</span>
        <span class="n">gain</span> <span class="o">=</span> <span class="n">gains</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">gains</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">1.0</span>  <span class="c1"># Vermeide Division durch 0</span>
        <span class="n">ps</span> <span class="o">=</span> <span class="n">power_supplies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Channel </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: Gain=</span><span class="si">{</span><span class="n">gain</span><span class="si">}</span><span class="s2">, PowerSupply=</span><span class="si">{</span><span class="n">ps</span><span class="si">}</span><span class="s2">, AdapterType=</span><span class="si">{</span><span class="n">adapter_types</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Raw Data (first 5 values): </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">ps</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">nADbits</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">gain</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Scaled (first 5 values): </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Scaling done.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>




  </div>

    </div>

  </div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>